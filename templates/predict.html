<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8' />
  <title>Mapbox Example</title>
  <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
  <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v2.6.1/mapbox-gl.js'></script>
  <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v2.6.1/mapbox-gl.css' rel='stylesheet' />
  <script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.0/mapbox-gl-geocoder.min.js'></script>
  <link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.0/mapbox-gl-geocoder.css' type='text/css' />
  <style>
    body { margin: 0; padding: 0; }
    #map { position: absolute; top: 25%; bottom: 0; width: 100%; height: 80%;}
    #geocoder-container {
            position: absolute;
            top: 25%;
            left: 10px;
            z-index: 1;
        }
    header {
        background-color: purple;
        color: white;
        padding: 20px;
        text-align: left;
    }

    .header2 {
        background-color: purple;
        color: white;
        text-align: center;
    }

    .header3 {
        background-color: purple;
        color: white;
        text-align: right;
    }

    .button-container {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        padding: 20px;
    }

    .button-container2 {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        padding: 20px;
    }

    .button1 {
        margin-bottom: 10px;
        background-color: yellow;
        color: black;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        cursor: pointer;
        padding: 20px;
        border: 2px solid #ffa500;
    }

    .button2 {
        margin-bottom: 10px;
        background-color: yellow;
        color: black;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        cursor: pointer;
        padding: 20px;
        border: 2px solid #ff5100;
    }

    .button3 {
        margin-bottom: 10px;
        background-color: yellow;
        color: black;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        cursor: pointer;
        padding: 20px;
        border: 2px solid #ffa500;
        width: 10%;
    }

    .button4 {
        margin-bottom: 10px;
        background-color: yellow;
        color: black;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        cursor: pointer;
        padding: 20px;
        border: 2px solid #ff5100;
        width: 10%;
    }

    .text-container {
        padding: 20px;
        flex: 1;
    }

  </style>
  <script src="https://cdn.tailwindcss.com">
</script>
<script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <header>
    <h1>Welcome to AccidentProphet</h1>
    <div class="header2">
        <h3>Predicting Road Incidents</h3>
    </div>
    
    <div class="flex justify-between items-start">
        <a href = "/" class="bg-white text-purple-600 font-bold py-2 px-4 rounded-md hover:bg-gray-200 transition duration-300 ease-in-out">
         Home
        </a>
        <a class="bg-white text-purple-600 font-bold py-2 px-4 rounded-md hover:bg-gray-200 transition duration-300 ease-in-out">
         About
        </a>
    </div>
  </header>
  <main>
    <div id='map'></div>
    <div id='geocoder-container'></div>
  </main>
  <script>
    mapboxgl.accessToken = 'pk.eyJ1Ijoia2FnZXJvdS1tYXRjaGEtbGF0dGUiLCJhIjoiY2t2cXFlNmhmMDBpajJ1bHlkeHVxdDFpOCJ9.kzvIYDL7iAoiwrp4Qi_6Kg';//put accessToken here
    var map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/mapbox/streets-v11', 
      center: [100.53125, 13.75], 
      zoom: 12 
    });


    var predicts = {{ predicts | tojson | safe }};

  console.log(predicts);

  var coordinatesList = predicts.map(function(predict) {
    return {
      lng: predict[0],
      lat: predict[1],
      severity: predict[2]
    };
  });


    var geocoder = new MapboxGeocoder({
            accessToken: mapboxgl.accessToken,
            mapboxgl: mapboxgl,
            placeholder: 'Enter a location',
        });

    document.getElementById('geocoder-container').appendChild(geocoder.onAdd(map));

    geocoder.on('result', function (e) {
        var coordinates = e.result.center;
        map.flyTo({
            center: coordinates,
            zoom: 12
        });
    }); 

    function getColor(severity) {
        var percentage = severity / 100;
        var green = 255 - Math.round(255 * percentage);
        var red = Math.round(255 * percentage);
        return 'rgba(' + red + ',' + green + ',0,0.4)';
    }

    map.on('load', function () {
      coordinatesList.forEach(function (coordinates) {
        var circleLayerId = 'circle-' + coordinates.lng + '-' + coordinates.lat;
        var color = getColor(coordinates.severity);
        console.log(color)
        map.addLayer({
            'id': circleLayerId,
            'type': 'circle',
            'source': {
                'type': 'geojson',
                'data': {
                    'type': 'Point',
                    'coordinates': [coordinates.lng, coordinates.lat]
                }
            },
            'paint': {
                'circle-radius': 
                    {
                        'base': 70,
                        'stops': [
                            [8, 7.5],
                            [11, 15],
                            [16, 60],
                            [19, 120],
                            [22, 180]
                        ]
                    }
                    ,
                'circle-color': color, 
                'circle-stroke-color': '#fff'
            }
        });
      });
    });

  </script>
</body>
</html>

